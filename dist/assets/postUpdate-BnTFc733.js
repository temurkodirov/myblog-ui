import{g as u,u as C,o as l,c as r,a as e,j as I,k as h,v as p,n as f,t as g,e as _,l as B,F as b,h as v,p as S,f as z,d as y}from"./index-BxNye9P6.js";import{c as d,r as w,m as k,a as x}from"./index-DdAual5n.js";import{u as L}from"./index-rtgCEYFi.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={name:"postUpdate",props:["updateId"],data(){return{categories:[],post:{title:"",content:"",categoryId:0,images:[]},selectedCategory:null,m_files:[]}},methods:{filesChangeHandler(t){this.m_files=[];let s=t.target.files;for(let a=0;a<s.length;a++)this.m_files.push({bb:window.URL.createObjectURL(s[a]),file:s[a]})},async fetchCategory(){try{let t=await u.get("category/get-all?PageSize=50");t.status===200&&(this.categories=t.data.items)}catch(t){console.error(t.message)}},successToast(){this.toast.success("Muvaffaqiyatlik yakunlandi",{position:"top-right",timeout:1800,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1})},errorToast(){this.toast.error("Xatolik yuz berdi",{position:"top-right",timeout:1800,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1})},async createPost(){if(this.v$.post.$touch(),this.v$.post.$invalid){window.scrollTo({top:0,behavior:"smooth"});return}const t=new FormData;for(let a=0;a<this.m_files.length;a++)t.append("Images",this.m_files[a].file);t.append("Id",this.updateId),t.append("Title",this.post.title),t.append("Content",this.post.content),t.append("CategoryId",this.selectedCategory);let s={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"multipart/form-data"}};try{(await u.post("post/update/"+this.updateId,t,s)).status===200&&(this.successToast(),this.$router.push("/blogs"))}catch(a){console.log(a.message)}},async fetchPost(){try{let t=await u.get("post/get/"+this.updateId);t.status===200&&(this.post.title=t.data.title,this.post.content=t.data.content,this.selectedCategory=t.data.categoryId)}catch(t){console.error(t.message)}}},setup(){const t=L(),s=C();return{v$:t,toast:s}},validations:{post:{title:{required:d.withMessage("Yozilishi shart",w),minLength:d.withMessage("3 ta belgidan ko'p  bo'lishi kerak",k(3)),maxLength:d.withMessage("100 ta belgidan kam bo'lishi kerak",x(100))},content:{required:d.withMessage("Yozilishi shart",w),minLength:d.withMessage("3 ta belgidan ko'p  bo'lishi kerak",k(3)),maxLength:d.withMessage("150000 ta belgidan kam bo'lishi kerak",x(15e4))}}},async mounted(){await this.fetchCategory(),await this.fetchPost()}},n=t=>(S("data-v-0796b6d6"),t=t(),z(),t),O={class:"container"},T={class:"row justify-content-center mt-5"},j={class:"col-lg-8 col-xl-6 col-md-12 col-sm-12"},F={class:"card mb-4"},H=n(()=>e("div",{class:"card-header d-flex align-items-center justify-content-between"},[e("h5",{class:"mb-0"},"Blogni tahrirlash")],-1)),U={class:"card-body"},V={class:"row mb-3"},$=n(()=>e("label",{class:"col-sm-2 col-form-label",for:"basic-default-name"},"Sarlavha",-1)),q={class:"col-sm-10"},D={key:0,class:"invalid-input-text"},Y={class:"row mb-3"},N=n(()=>e("label",{class:"col-sm-2 col-form-label",for:"basic-default-message"},"Blog",-1)),R={class:"col-sm-10"},A={key:0,class:"invalid-input-text"},E={class:"row mb-3"},X=n(()=>e("label",{class:"col-sm-2 form-label",for:"exampleFormControlSelect1"},"Blog turi",-1)),G={class:"col-sm-10"},J=["value"],K={class:"row mb-3"},Q=n(()=>e("label",{for:"forimages",class:"col-sm-2 col-form-label"},"Rasmlar",-1)),W={class:"col-sm-10"},Z=n(()=>e("p",{class:"text-muted mt-1"},[y("Yangi rasm yuklasangiz eski rasmlar o'chib ketadi "),e("br"),y(" Yangi rasm yuklamasez rasmlar o'z xolida qoladi ")],-1)),ee={class:"row mb-3"},te=n(()=>e("label",{class:"col-sm-2"},null,-1)),se={class:"col-sm-10 image-container gap-2 d-flex flex-wrap"},oe=["src"],ae={class:"row justify-content-end"},ie={class:"col-sm-10"},le={class:"d-flex justify-content-end"};function re(t,s,a,c,i,m){return l(),r("div",O,[e("div",T,[e("div",j,[e("div",F,[H,e("div",U,[e("form",{onSubmit:s[5]||(s[5]=I(()=>{},["prevent"]))},[e("div",V,[$,e("div",q,[h(e("input",{type:"text",class:f(["form-control",{"invalid-input":c.v$.post.title.$error}]),"onUpdate:modelValue":s[0]||(s[0]=o=>i.post.title=o),id:"basic-default-name",placeholder:"Sarlavha"},null,2),[[p,i.post.title]]),c.v$.post.title.$error?(l(),r("div",D,g(c.v$.post.title.$errors[0].$message),1)):_("",!0)])]),e("div",Y,[N,e("div",R,[h(e("textarea",{id:"basic-default-message",class:f(["form-control",{"invalid-input":c.v$.post.content.$error}]),"onUpdate:modelValue":s[1]||(s[1]=o=>i.post.content=o),rows:"4",placeholder:"Blog matnini shu yerga yozing...","aria-label":"Blog matnini shu yerga yozing...","aria-describedby":"basic-icon-default-message2"},null,2),[[p,i.post.content]]),c.v$.post.content.$error?(l(),r("div",A,g(c.v$.post.content.$errors[0].$message),1)):_("",!0)])]),e("div",E,[X,e("div",G,[h(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=o=>i.selectedCategory=o),id:"exampleFormControlSelect1","aria-label":"Default select example"},[(l(!0),r(b,null,v(i.categories,o=>(l(),r("option",{value:o.id},g(o.name),9,J))),256))],512),[[B,i.selectedCategory]])])]),e("div",K,[Q,e("div",W,[e("input",{onChange:s[3]||(s[3]=(...o)=>m.filesChangeHandler&&m.filesChangeHandler(...o)),type:"file",id:"files",name:"files[]",class:"form-control",accept:"image/x-png, image/jpeg, image/jpg",multiple:""},null,32),Z])]),e("div",ee,[te,e("div",se,[(l(!0),r(b,null,v(i.m_files,o=>(l(),r("div",{key:o.bb},[e("img",{src:o.bb,alt:"Image preview",class:"previewImage"},null,8,oe)]))),128))])]),e("div",ae,[e("div",ie,[e("div",le,[e("button",{onClick:s[4]||(s[4]=(...o)=>m.createPost&&m.createPost(...o)),type:"submit",class:"btn btn-primary"},"Yangilash")])])])],32)])])])])])}const ue=M(P,[["render",re],["__scopeId","data-v-0796b6d6"]]);export{ue as default};
