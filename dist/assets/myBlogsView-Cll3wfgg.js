import{g as v,u as S,r as x,o as i,c as l,a as e,k as I,v as B,n as P,F as d,h as m,e as w,t as h,b as u,w as b,d as C,p as D,f as N}from"./index-BxNye9P6.js";import{C as T,P as O,a as z,t as U}from"./carouselCardDesign-BY-aaCbG.js";import{f as L}from"./formateDate-BvL5N5Zm.js";import{u as j}from"./index-rtgCEYFi.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./imagePathfixer-CcxXgNhq.js";const V={name:"myBlogsView",components:{CarouselCardDesign:T,PostSkeleton:O,PostCarousel:z},data(){return{selectedBlogId:0,metaData:{currentPage:1,totalPages:1,pageSize:6,totalCount:0,order:"desc",hasPrevious:!1,hasNext:!1},params:{SearchText:null,CategoryId:null,UserId:null,PageNumber:1,PageSize:6,Order:null},postImages:["@/assets/img/elements/18.jpg","@/assets/img/elements/18.jpg"],posts:[],categories:[],postsLoaded:!1,searchQuery:""}},created(){this.$watch(()=>this.$route.query.CategoryId,async(s,t)=>{this.readParamsFromUrl(),await this.fetchPosts(this.params)})},computed:{computedPageNumber:{get(){return this.params.PageNumber},set(s){this.params.PageNumber=s,this.fetchPosts(this.params)}}},methods:{formatDate:L,textCutter:U,async fetchPosts(s){let t={...s};const n=new URLSearchParams(window.location.search);for(const o of n.keys())n.delete(o);for(const[o,g]of Object.entries(t))g!==null?n.set(o,g.toString()):n.delete(o);t.PageNumber<=1&&(n.delete("PageNumber"),n.delete("PageSize")),(t.Order==="desc"||t.Order==="DESC")&&n.delete("Order"),n.delete("UserId");const _=n.toString(),r=_?`${window.location.pathname}?${_}`:window.location.pathname;window.history.replaceState(null,"",r);try{this.posts=[];let o=null;o=await v.get("post/get-all",{params:t}),o.status===200&&(this.posts=o.data.items,this.metaData={...o.data.metaData},this.params.PageNumber=this.metaData.currentPage),this.postsLoaded=!0}catch(o){console.log(o.message)}},readParamsFromUrl(){const s=window.location.search,t=new URLSearchParams(s);t.get("SearchText")!=="null"&&t.has("SearchText")&&t.get("SearchText")!==null&&(this.params.SearchText=t.get("SearchText")),t.has("SearchText")&&t.get("SearchText")!=="null"&&(this.params.SearchText=t.get("SearchText")),t.has("CategoryId")&&t.get("CategoryId")!=="null"&&(this.params.CategoryId=t.get("CategoryId")),t.get("PageNumber")!==null&&(this.params.PageNumber=parseInt(t.get("PageNumber"))),t.get("PageSize")!==null&&(this.params.PageSize=parseInt(t.get("PageSize"))),t.get("Order")!==null&&(this.params.Order=t.get("Order"))},getPaginatedData(){this.fetchPosts(this.params)},async searchPost(){this.searchQuery.length<3?(this.params.SearchText=null,this.searchQuery.length===0&&await this.fetchPosts(this.params)):(this.params.SearchText=this.searchQuery,await this.fetchPosts(this.params))},async postsByCategory(s){this.params.CategoryId=s,await this.fetchPosts(this.params)},async changePage(s){this.params.PageNumber=s,await this.fetchPosts(this.params)},successToast(){this.toast.success("Muvaffaqiyatlik yakunlandi",{position:"top-right",timeout:1800,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1})},errorToast(){this.toast.error("Xatolik yuz berdi",{position:"top-right",timeout:1800,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1})},async deleteBlog(){let s={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};try{if(this.selectedBlogId===0)return;(await v.delete("post/delete/"+this.selectedBlogId,s)).status===200&&(this.successToast(),await this.fetchPosts(this.params))}catch(t){console.error(t.message),this.errorToast()}},selectBlogForDelete(s){this.selectedBlogId=s},async fetchCategory(){try{let s=await v.get("category/get-all?PageSize=50");s.status===200&&(this.categories=s.data.items,this.selectedCategory=this.categories[0].id)}catch(s){console.error(s.message)}}},setup(){const s=j(),t=S();return{v$:s,toast:t}},async mounted(){this.lokalUser=await JSON.parse(localStorage.getItem("lokalUser")),this.params.UserId=this.lokalUser.userId,await this.readParamsFromUrl(),await this.fetchPosts(this.params),await this.fetchCategory()}},c=s=>(D("data-v-a8d6ded8"),s=s(),N(),s),q={class:"container-xxl flex-grow-1 container-p-y"},Q={class:"row"},H={class:"col-md-6 col-lg-3 col-xl-3 order-0 mb-4"},M={class:"card"},A={class:"card-body"},E={class:"input-group input-group-merge mb-4"},R=c(()=>e("span",{class:"input-group-text",id:"basic-addon-search31"},[e("i",{class:"bx bx-search"})],-1)),J={class:"p-0 m-0"},X={class:"d-flex mb-4 pb-1"},Y=c(()=>e("div",{class:"avatar flex-shrink-0 me-3"},[e("span",{class:"avatar-initial rounded bg-label-primary"},[e("i",{class:"bx bx-category"})])],-1)),G={class:"d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"},K={class:"me-2"},W={class:"d-flex mb-4 pb-1"},Z=c(()=>e("div",{class:"avatar flex-shrink-0 me-3"},[e("span",{class:"avatar-initial rounded bg-label-primary"},[e("i",{class:"bx bx-category"})])],-1)),$={class:"d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"},ee={class:"me-2"},te=["onClick"],se={class:"col-lg-9"},ae={key:0,class:"row mb-5 m-auto"},oe={class:"col-sm-12 col-md-6 col-lg-4 mb-4"},re={key:1,class:"row mb-5 m-auto"},ie={class:"card"},le={class:"d-flex justify-content-center pt-3 px-3"},ne={class:"card-body pb-0"},ce={class:"card-title mb-0"},de={key:0,class:"badge bg-label-dark my-1"},he={class:"card-text text-dark"},ue={class:"d-flex align-items-center justify-content-between mt-2 mb-0"},me=c(()=>e("i",{class:"bx bx-calendar"},null,-1)),ge={class:"card-footer mt-0 py-3 d-flex justify-content-between"},pe=["onClick"],be={class:"modal fade",id:"deleteBlogModal",tabindex:"-1",style:{display:"none"},"aria-hidden":"true"},_e={class:"modal-dialog modal-sm modal-dialog-centered",role:"document"},ye={class:"modal-content"},fe=c(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel1"},"Blogni o'chirish"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ve=c(()=>e("div",{class:"modal-body"},[e("h6",null," Siz rostdan ham ushbu blogni o'chirishni hohlaysizmi?")],-1)),xe={class:"modal-footer"},Pe=c(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," Yo'q ",-1)),we={class:"d-flex justify-content-center"},Ce={"aria-label":"Page navigation"},ke={class:"pagination"},Se={class:"page-item prev"},Ie=["disabled"],Be=c(()=>e("i",{class:"tf-icon bx bx-chevron-left"},null,-1)),De=[Be],Ne={class:"page-item"},Te=["onClick"],Oe={class:"page-item next"},ze=["disabled"],Ue=c(()=>e("i",{class:"tf-icon bx bx-chevron-right"},null,-1)),Le=[Ue];function je(s,t,n,_,r,o){const g=x("post-skeleton"),k=x("carousel-card-design"),p=x("router-link");return i(),l("div",q,[e("div",Q,[e("div",H,[e("div",M,[e("div",A,[e("div",E,[R,I(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>r.searchQuery=a),placeholder:"Search...","aria-label":"Search...","aria-describedby":"basic-addon-search31",onInput:t[1]||(t[1]=a=>o.searchPost())},null,544),[[B,r.searchQuery]])]),e("ul",J,[e("li",X,[Y,e("div",G,[e("div",K,[e("button",{style:{width:"230px"},onClick:t[2]||(t[2]=a=>o.postsByCategory(null)),class:P(["btn btn-outline-primary mb-0",{active:r.params.CategoryId===null}])}," Barcha turdagi bloglar ",2)])])]),(i(!0),l(d,null,m(r.categories,a=>(i(),l("li",W,[Z,e("div",$,[e("div",ee,[e("button",{style:{width:"230px"},onClick:y=>o.postsByCategory(a.id),class:P([{active:r.params.CategoryId==a.id},"btn btn-outline-primary mb-0"])},h(a.name),11,te)])])]))),256))])])])]),e("div",se,[r.postsLoaded?w("",!0):(i(),l("div",ae,[(i(),l(d,null,m(6,a=>e("div",oe,[u(g)])),64))])),r.postsLoaded?(i(),l("div",re,[(i(!0),l(d,null,m(r.posts,(a,y)=>(i(),l("div",{class:"col-sm-12 col-md-6 col-lg-4 mb-4",key:y},[e("div",ie,[e("div",le,[u(k,{"img-list":a.images},null,8,["img-list"])]),e("div",ne,[u(p,{to:{name:"blogDetails",params:{blogId:a.id}}},{default:b(()=>[e("h5",ce,h(o.textCutter(a.title,30)),1)]),_:2},1032,["to"]),(i(!0),l(d,null,m(r.categories,f=>(i(),l(d,null,[f.id===a.categoryId?(i(),l("span",de,h(f.name),1)):w("",!0)],64))),256)),u(p,{to:{name:"blogDetails",params:{blogId:a.id}}},{default:b(()=>[e("p",he,h(o.textCutter(a.content,100)),1)]),_:2},1032,["to"]),e("span",ue,[e("span",null,[me,C(" "+h(o.formatDate(a.createdAt)),1)]),u(p,{to:{name:"blogDetails",params:{blogId:a.id}}},{default:b(()=>[C(" Davomini o'qish -> ")]),_:2},1032,["to"])])]),e("div",ge,[u(p,{to:{name:"blogUpdate",params:{updateId:a.id}},class:"btn btn-warning"},{default:b(()=>[C(" Tahrirlash ")]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-danger",onClick:f=>o.selectBlogForDelete(a.id),"data-bs-toggle":"modal","data-bs-target":"#deleteBlogModal"}," O'chirish ",8,pe)])])]))),128))])):w("",!0),e("div",be,[e("div",_e,[e("div",ye,[fe,ve,e("div",xe,[Pe,e("button",{type:"button",onClick:t[3]||(t[3]=a=>o.deleteBlog()),class:"btn btn-primary","data-bs-dismiss":"modal"},"Ha")])])])]),e("div",we,[e("nav",Ce,[e("ul",ke,[e("li",Se,[e("button",{class:"btn btn-icon btn-outline-primary btn-size",disabled:!r.metaData.hasPrevious,onClick:t[4]||(t[4]=a=>o.changePage(this.params.PageNumber-1))},De,8,Ie)]),(i(!0),l(d,null,m(r.metaData.totalPages,a=>(i(),l("li",Ne,[e("button",{class:P(["btn btn-icon btn-outline-primary btn-size",{"active-pg-btn":this.metaData.currentPage===a}]),onClick:y=>o.changePage(a)},h(a),11,Te)]))),256)),e("li",Oe,[e("button",{class:"btn btn-icon btn-outline-primary btn-size",disabled:!r.metaData.hasNext,onClick:t[5]||(t[5]=a=>o.changePage(this.params.PageNumber+1))},Le,8,ze)])])])])])])])}const Ae=F(V,[["render",je],["__scopeId","data-v-a8d6ded8"]]);export{Ae as default};
